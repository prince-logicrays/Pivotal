<?php
/**
 * Logicrays
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the logicrays.com license that is
 * available through the world-wide-web at this URL:
 * https://www.logicrays.com/
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Logicrays Team
 * @package     Logicrays_EmailFilter
 * @copyright   Copyright (c) Logicrays (https://www.logicrays.com/)
 * @license     https://www.logicrays.com/
 */

$helper = \Magento\Framework\App\ObjectManager::getInstance()->get('Logicrays\EmailFilter\Helper\Data');
$emailRestriction = $helper->getEmailrestrictonsplit();
$fullPathActionName = $this->getRequest()->getFullActionName();
$IsCheckEnable = 0;

if ($fullPathActionName == 'contact_index_index') {
    $IsCheckEnable = $helper->getContactRestriction();
}
if ($fullPathActionName == 'customer_account_create') {
    $IsCheckEnable = $helper->getRegistrationRestriction();
}
if ($fullPathActionName == 'checkout_index_index') {
    $IsCheckEnable = $helper->getCheckoutRestriction();
}
?>

<?php if ($helper->isEnabled() && $IsCheckEnable): ?>
<script type="text/javascript">
require([
    'jquery',
    'jquery/ui',
    'jquery/validate',
    'mage/translate',
    'mage/mage'
], function($){
    $("input[id='customer-email']").addClass("customemail");
    $("input[id='email_address']").addClass("customemail");
    $("input[id='email_address1']").addClass("customemail");

    $.validator.addMethod(
    'customemail', function (value) {
        var isValid = true;
        var complex = <?= $emailRestriction ?>;
        $.each(complex, function(i, item){
            if(value.includes(item)){
                isValid = false;
            }
        });
    return isValid;
    }, $.mage.__('Sorry, your e-mail address is not available at this store.!'));

    $('.customemail').change(function() {
        $.validator.validateSingleElement('.customemail');
    });

     $.validator.addMethod(
        'valid', function (value) { 
            var isValid = true;
            var complex = <?= $emailRestriction ?>;          
            $.each(complex, function(i, item){
                if(value.includes(item)){
                    isValid = false;
                }
            });
            return isValid;
        }, $.mage.__('Sorry, your e-mail address is not available at this store.!'));

    $('.valid').change(function() {
        $.validator.validateSingleElement('.valid');          
    });
});

</script>
<?php endif; ?>
<?php if ($helper->isEnabled() && $helper->getNewslatterRestriction()): ?>
<script type="text/javascript">
     require([
    'jquery',
    'jquery/ui',
    'jquery/validate',
    'mage/translate',
    'mage/mage'
], function($){
    $("#newsletter").addClass("newslatteremail").removeClass(".customemail");

     $.validator.addMethod(
        'newslatteremail', function (value) { 
            var isValid = true;
            var complex = <?= $emailRestriction ?>;          
            $.each(complex, function(i, item){
                if(value.includes(item)){
                    isValid = false;
                }
            });
            return isValid;
        }, $.mage.__('Sorry, your e-mail address is not available at this store.!'));

    $('.newslatteremail').change(function() {
        $.validator.validateSingleElement('.newslatteremail');          
    });

});

</script>
<?php endif; ?>